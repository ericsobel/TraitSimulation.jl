\documentclass[12pt]{article}
\usepackage{etoolbox}
\usepackage{bbm}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{mathabx}
\usepackage{graphicx}
\usepackage{float}
\usepackage{parskip}
\usepackage{indentfirst}
\usepackage{hyperref}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{setspace}
\usepackage[margin=1in]{geometry}
\usepackage{booktabs}
\usepackage{rotating}
\usepackage{authblk}
\usepackage{color}
\setlength{\parskip}{0em}
\setlength{\parindent}{2em}
\floatplacement{figure}{H}
\usepackage[normalem]{ulem}
\usepackage[super,comma,sort]{natbib}
\usepackage{verbatim}

\def\E{\mathop{\rm E\,\!}\nolimits}
\def\Var{\mathop{\rm Var}\nolimits}
\def\Cov{\mathop{\rm Cov}\nolimits}
\def\Cor{\mathop{\rm Cor}\nolimits}
\def\den{\mathop{\rm den}\nolimits}
\def\midd{\mathop{\,|\,}\nolimits}
\def\sgn{\mathop{\rm sgn}\nolimits}
\def\sinc{\mathop{\rm sinc}\nolimits}
\def\curl{\mathop{\rm curl}\nolimits}
\def\div{\mathop{\rm div}\nolimits}
\def\tr{\mathop{\rm tr}\nolimits}
\def\len{\mathop{\rm len}\nolimits}
\def\vec{\mathop{\rm vec}\nolimits}
\def\diag{\mathop{\rm diag}\nolimits}
\def\dist{\mathop{\rm dist}\nolimits}
\def\Pen{\mathop{\rm Pen}\nolimits}
\def\Prior{\mathop{\rm Prior}\nolimits}
\def\Tran{\mathop{\rm Tran}\nolimits}
\def\prox{\mathop{\rm prox}\nolimits}
\def\rank{\mathop{\rm rank}\nolimits}
\def\argmin{\mathop{\rm argmin}\nolimits}
\newtheorem{proposition}{Proposition}[section]
\newtheorem{example}{Example}[section]
\newcommand{\svskip}{\vspace{1.75mm}}
\newcommand{\amp}{\mathop{\:\:\,}\nolimits}
\newcommand{\ba}{\boldsymbol{a}}
\newcommand{\bb}{\boldsymbol{b}}
\newcommand{\bc}{\boldsymbol{c}}
\newcommand{\bd}{\boldsymbol{d}}
\newcommand{\be}{\boldsymbol{e}}
\newcommand{\bff}{\boldsymbol{f}}
\newcommand{\bg}{\boldsymbol{g}}
\newcommand{\bh}{\boldsymbol{h}}
\newcommand{\bi}{\boldsymbol{i}}
\newcommand{\bj}{\boldsymbol{j}}
\newcommand{\bk}{\boldsymbol{k}}
\newcommand{\bl}{\boldsymbol{l}}
\newcommand{\bmm}{\boldsymbol{m}}
\newcommand{\bn}{\boldsymbol{n}}
\newcommand{\bo}{\boldsymbol{o}}
\newcommand{\bp}{\boldsymbol{p}}
\newcommand{\bq}{\boldsymbol{q}}
\newcommand{\br}{\boldsymbol{r}}
\newcommand{\bs}{\boldsymbol{s}}
\newcommand{\bt}{\boldsymbol{t}}
\newcommand{\bu}{\boldsymbol{u}}
\newcommand{\bv}{\boldsymbol{v}}
\newcommand{\bw}{\boldsymbol{w}}
\newcommand{\bx}{\boldsymbol{x}}
\newcommand{\by}{\boldsymbol{y}}
\newcommand{\bz}{\boldsymbol{z}}
\newcommand{\bA}{\boldsymbol{A}}
\newcommand{\bB}{\boldsymbol{B}}
\newcommand{\bC}{\boldsymbol{C}}
\newcommand{\bD}{\boldsymbol{D}}
\newcommand{\bE}{\boldsymbol{E}}
\newcommand{\bF}{\boldsymbol{F}}
\newcommand{\bG}{\boldsymbol{G}}
\newcommand{\bH}{\boldsymbol{H}}
\newcommand{\bI}{\boldsymbol{I}}
\newcommand{\bJ}{\boldsymbol{J}}
\newcommand{\bK}{\boldsymbol{K}}
\newcommand{\bL}{\boldsymbol{L}}
\newcommand{\bM}{\boldsymbol{M}}
\newcommand{\bN}{\boldsymbol{N}}
\newcommand{\bO}{\boldsymbol{O}}
\newcommand{\bP}{\boldsymbol{P}}
\newcommand{\bQ}{\boldsymbol{Q}}
\newcommand{\bR}{\boldsymbol{R}}
\newcommand{\bS}{\boldsymbol{S}}
\newcommand{\bT}{\boldsymbol{T}}
\newcommand{\bU}{\boldsymbol{U}}
\newcommand{\bV}{\boldsymbol{V}}
\newcommand{\bW}{\boldsymbol{W}}
\newcommand{\bX}{\boldsymbol{X}}
\newcommand{\bY}{\boldsymbol{Y}}
\newcommand{\bZ}{\boldsymbol{Z}}
\newcommand{\T}{\intercal}
\newcommand{\bzero}{\boldsymbol{0}}
\newcommand{\balpha}{\boldsymbol{\alpha}}
\newcommand{\bbeta}{\boldsymbol{\beta}}
\newcommand{\bgamma}{\boldsymbol{\gamma}}
\newcommand{\bdelta}{\boldsymbol{\delta}}
\newcommand{\bepsilon}{\boldsymbol{\epsilon}}
\newcommand{\blambda}{\boldsymbol{\lambda}}
\newcommand{\bmu}{\boldsymbol{\mu}}
\newcommand{\bnu}{\boldsymbol{\nu}}
\newcommand{\bphi}{\boldsymbol{\phi}}
\newcommand{\bpsi}{\boldsymbol{\psi}}
\newcommand{\bpi}{\boldsymbol{\pi}}
\newcommand{\bsigma}{\boldsymbol{\sigma}}
\newcommand{\btheta}{\boldsymbol{\theta}}
\newcommand{\bomega}{\boldsymbol{\omega}}
\newcommand{\bxi}{\boldsymbol{\xi}}
\newcommand{\bGamma}{\boldsymbol{\Gamma}}
\newcommand{\bDelta}{\boldsymbol{\Delta}}
\newcommand{\bTheta}{\boldsymbol{\Theta}}
\newcommand{\bLambda}{\boldsymbol{\Lambda}}
\newcommand{\bXi}{\boldsymbol{\Xi}}
\newcommand{\bPi}{\boldsymbol{\Pi}}
\newcommand{\bSigma}{\boldsymbol{\Sigma}}
\newcommand{\bUpsilon}{\boldsymbol{\Upsilon}}
\newcommand{\bPhi}{\boldsymbol{\Phi}}
\newcommand{\bPsi}{\boldsymbol{\Psi}}
\newcommand{\bOmega}{\boldsymbol{\Omega}}
\newcommand{\real}{\mathbb{R}}
%-----------------------------------------------------------------------------


\begin{document}

\title{Trait simulation}
\author{Huwenbo Shi}
\maketitle

\begin{spacing}{1.0}

\section{Types of simulations}

\subsection{GWAS simulation }

\subsubsection{Single quantitative trait simulation}
\begin{itemize}
    \item Users specify
        \begin{enumerate}
            \item Genotype matrix
            \item Effect size vector for SNPs
            \item Desired heritability
            \item Desired missing rate
        \end{enumerate}
    \item Model: $\by = \bX \bbeta + \bepsilon$
    \item $\by$: trait values for $n$ individuals
    \item $\bX$: the $n \times p$ genotype matrix, provided by the user (allelic? standardized?)
    \item $\bbeta$: the $p$-vector of effect sizes, provided by the user
    \item $\bepsilon$: the $n$-vector of environmental effect, drawn by the program such
          that the desired amount of heritability is achieved.
\end{itemize}

\subsubsection{Single case-control trait simulation}
\begin{itemize}
    \item Users specify
        \begin{enumerate}
            \item Genotype matrix
            \item Effect size vector for SNPs
            \item Desired heritability
            \item Prevalence of the cases
            \item Desired number of cases and controls
        \end{enumerate}
    \item Simulation procedure
    \begin{enumerate}
        \item First, simulate liability based on $\by = \bX \bbeta + \bepsilon$
        \item Then, select liability threshold based on prevalence
        \item Finall, draw cases and controls according to the specified numbers
    \end{enumerate}
\end{itemize}

\subsection{Two correlated traits}
\begin{itemize}
    \item Users specify
        \begin{enumerate}
            \item Genotype matrix
            \item SNP effect size vectors for 2 traits
            \item Desired heritability for 2 traits
            \item Desired missing rate for 2 traits (or prevalence and number of cases and
                  controls for case-control traits)
            \item Desired phenotypic correlations between the two traits
        \end{enumerate}
    \item Model: $\by_1 = \bX \bbeta + \bepsilon$, $\by_2 = \bX \bgamma + \bdelta$
    \item Simulation procedure
    \begin{enumerate}
        \item First, simulate the genetic component $\bX\bbeta$ and $\bX\bgamma$
        \item Compute $\Var[\bX\bbeta]$, $\Var[\bX\bgamma]$, and $\Cov[\bX\bbeta, \bX\bgamma]$
        \item Find $\sigma^2_\epsilon$, $\sigma^2_\delta$, and $\sigma_{\epsilon\delta}$
              and draw $\bepsilon$ and $\bdelta$, from bivariate normal (parameterized by
              $\sigma^2_\epsilon$, $\sigma^2_\delta$, and $\sigma_{\epsilon\delta}$),
              such that the desired amount of heritability and phenotypic correlation are achieved.
        \item Dichotomize liability for case-control traits
    \end{enumerate}
\end{itemize}

\subsection{Variance component simulation}

\subsubsection{Two variance components ($\sigma^2_g$, $\sigma^2_e$)}

    \begin{itemize}
        \item Users specify
            \begin{enumerate}
                \item Heritability of the trait ($\sigma^2_g$)
                \item Genotype matrix
                \item Missing rate
                \item Mean effect
            \end{enumerate}
        \item Model $\by = \bmu + \bX \bu + \bepsilon$
        \item $\by$: $n$-vector of trait values
        \item $\bX$: Standardized $n \times p$ genotype matrix
        \item $\bu$: $p$-vector of SNP effect ($\bu \sim N(0, \sigma^2_g / p)$)
        \item $\bmu$: mean effect (can be a function of genotypes, i.e. $\bmu_i = \tilde{\bmu}_{i} +\bX_{ik}$?)
        \item Simulate from
              $N \left(
                      \bmu,
                      \sigma^2_g \bX\bX^\T / n + \sigma^2_e \bI
                  \right)$
    \end{itemize}

\subsubsection{Mutiple variance components ($\sigma^2_g$, $\sigma^2_i$, $\sigma^2_e$)}

    \begin{itemize}
        \item Users specify
            \begin{enumerate}
                \item $\sigma^2_g$, and all $\sigma^2_i$
                \item Genotype matrix
                \item All other design matrices for each variance component
                \item Missing rate
                \item Mean effect
            \end{enumerate}
        \item Model $\by = \bmu + \bX \bu + \sum_i \bW_i \bv_i + \bepsilon$
        \item $\bX$: standardized $n \times p$ genotype matrix
        \item $\bW_i$: design matrices for each variance component
    \end{itemize}

\subsection{General multiple correlated traits and multiple variance components simulation}

    \begin{itemize}
        \item Users specify
        \begin{enumerate}
            \item Mean effects $\bmu_i$ for $m$ traits
            \item Genotype matrix $\bX$
            \item Design matrices for each variance component $\bW_i$
            \item Heritability: $\sigma^2_{gj}$ (heritability of trait $j$)
            \item Other variance components: $\sigma^2_{ij}$
            \item Genetic covariances: $\sigma_{gjk}$ for the pair of traits $\by_j$ and $\by_l$
            \item Random noise covariances: $\sigma_{ejk}$ for the pair of traits $\by_j$ and $\by_l$
            \item Other covariances: $\sigma_{ijk}$ for the pair of traits $\by_j$ and $\by_l$
        \end{enumerate}                
        \item Simulate from the model
        \begin{equation*}
            \begin{split}
            N \left(
                \left[
                    \begin{array}{c}
                        \bmu_i \\
                        \vdots \\
                        \bmu_m
                    \end{array}
                \right],
                \bC_g  \otimes {\bX\bX^\T \over n}
                + \sum_i \bC_i \otimes {\bW_i\bW_i^\T \over n} + \bC_e \otimes \bI
              \right) \text{,\;where\;}
            \bC_* =
            \left[
                \begin{array}{ccc}
                    \sigma^2_{*1} & \cdots & \sigma_{*1m} \\
                    \vdots & \ddots & \vdots \\
                    \sigma_{*m1} & \cdots & \sigma^2_{*m}
                \end{array}
            \right]
           \end{split}
        \end{equation*}
    \end{itemize}

\end{spacing}
%-----------------------------------------------------------------------------


\end{document}
